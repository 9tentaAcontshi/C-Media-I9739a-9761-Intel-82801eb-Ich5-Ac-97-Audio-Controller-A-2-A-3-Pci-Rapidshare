def isFullRelease = !project.version.endsWith('-SNAPSHOT')
def proj = project

jreleaser {
    environment {
        properties.put('rawChangelog', file("misc/changelogs/${version}.txt").exists() ?
                file("misc/changelogs/${version}.txt").text.replace('\r\n', '\n') : "")
    }

    project {
        name = 'X-Pipe Java'
        description = '<TODO>'
        longDescription = '<TODO>'
        website = 'https://github.com/xpipe-io/xpipe_java'
        authors = ['Christopher Schnick']
        license = 'MIT'
        copyright = '2022, Christopher Schnick'

        java {
            groupId = 'io.xpipe'
            version = '17'
            multiProject = true
        }
    }

    release {
        github {
            skipTag = !isFullRelease
            repoOwner = 'xpipe-io'
            overwrite = true
            tagName = proj.version
            releaseName = proj.version
            token = proj.hasProperty("XPIPE_GITHUB_TOKEN") ? proj.property("XPIPE_GITHUB_TOKEN") : System.getenv("XPIPE_GITHUB_TOKEN")
            draft = false

            files = true
            artifacts = true
            checksums = true
            signatures = false

            if (isFullRelease) {
                changelog {
                    enabled = true
                    formatted = 'ALWAYS'
                    contentTemplate = isFullRelease ? file('misc/github_full.tpl') : file('misc/github_pre.tpl')
                }
            }

            prerelease {
                enabled = !isFullRelease
            }
        }
    }
    distributions {
        api {
            artifact {
                distributionType = 'SINGLE_JAR'
                path = 'api/build/libs/xpipe-api-{{version}}.jar'
            }
        }

        core {
            artifact {
                distributionType = 'SINGLE_JAR'
                path = 'core/build/libs/xpipe-core-{{version}}.jar'
            }
        }

        beacon {
            artifact {
                distributionType = 'SINGLE_JAR'
                path = 'beacon/build/libs/xpipe-beacon-{{version}}.jar'
            }
        }

        extension {
            artifact {
                distributionType = 'SINGLE_JAR'
                path = 'extension/build/libs/xpipe-extension-{{version}}.jar'
            }
        }
    }

    if (isFullRelease) {
        announce {
            discord {
                active = 'RELEASE'
                webhook = proj.hasProperty("XPIPE_DISCORD_WEBHOOK") ? proj.property("XPIPE_DISCORD_WEBHOOK") : System.getenv("XPIPE_DISCORD_WEBHOOK")
                messageTemplate = isFullRelease ? 'misc/discord_full.tpl' : 'misc/discord_pre.tpl'
            }
        }
    }
}
